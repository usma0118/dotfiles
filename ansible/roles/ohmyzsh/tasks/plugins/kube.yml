---
- name: Install kube devops
  community.general.homebrew:
    name: "{{ item }}"
    state: latest
  loop:
    - kubectl
    - fluxcd/tap/flux
  when: ansible_os_family == 'Darwin'
- name: Ensure flux bindings exist once in ~/.zshrc
  ansible.builtin.blockinfile:
    path: "{{ ansible_env.HOME }}/.zshrc"
    insertafter: EOF
    marker: "# {mark} flux"
    block: |
      [ -f flux ] && source <(flux completion bash)
- name: Ensure kubectl exist once in ~/.zshrc
  ansible.builtin.blockinfile:
    path: "{{ ansible_env.HOME }}/.zshrc"
    marker: "# {mark} kubectl"
    insertafter: EOF
    block: |
      [ -f kubectl ] && source <(kubectl completion zsh)
